<!DOCTYPE html>
<html lang="zh-Hans" data-darkmode="auto">
<head>
  <meta charset="UTF-8">
  <title>eraftå¼€å‘ç»„ - è§£è¯»å›½å¤–ä¼˜è´¨è®¡ç®—æœºè¯¾ç¨‹</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="./heti.css">
  <link rel="stylesheet" href="./index.css">
  <link rel="icon" href="./favicon.svg">
</head>
<body>
  <main class="container">
    <article class="article heti heti--classic">
      <h1 class="article__title">eraftå¼€å‘ç»„</h1>
      <blockquote>

        æˆ‘ä»¬å›¢é˜Ÿè‡´åŠ›äºè§£è¯»å›½å¤–ä¼˜ç§€çš„åˆ†å¸ƒå¼å­˜å‚¨ç›¸å…³å¼€æºè¯¾ç¨‹ï¼Œä¸‹é¢æ˜¯è¯¾ç¨‹ä½“ç³»å›¾
        æˆ‘ä»¬å§‹ç»ˆåšä¿¡ä¼˜ç§€çš„æœ¬ç§‘æ•™å­¦ä¸åº”è¯¥æ˜¯ç…§æœ¬å®£ç§‘ä»¥åŠåº”ä»˜è€ƒè¯•ï¼Œä¸€é—¨ä¼˜ç§€çš„è¯¾ç¨‹ï¼Œåº”è¯¥å…·å¤‡è®©å­¦ç”Ÿå­¦ä¼šæ€è€ƒã€åŠ¨æ‰‹å®è·µã€æ‰¾åˆ°é—®é¢˜ã€åå¤è¯•é”™ã€å¹¶è§£å†³é—®é¢˜çš„èƒ½åŠ›ï¼ŒåŒæ—¶åº”è¯¥å°½é‡ç”¨æœ€ç›´ç™½ï¼Œæœ€ç®€å•çš„è¯­è¨€ä¼ è¾¾å…³é”®çš„çŸ¥è¯†ç‚¹ã€‚ä½œä¸ºè®¡ç®—æœºå·¥ä¸šç•Œçš„å·¥ä½œè€…ï¼Œæˆ‘ç›¸ä¿¡åšè¯¾ç¨‹å’ŒåšæŠ€æœ¯ä¸€æ ·ï¼Œå¹¶ä¸æ˜¯è¶Šå¤æ‚è¶Šå¥½ï¼Œåº”è¯¥å°½é‡çš„è®©è®¾è®¡å‡ºæ¥çš„ä¸œè¥¿ç®€å•åŒ–ã€‚
        å…³æ³¨æˆ‘ä»¬çš„æœ€æ–°åŠ¨æ€ï¼Œæ¬¢è¿å…³æ³¨
         
        <a href="https://www.zhihu.com/people/liu-jie-84-52" target="_blank">https://www.zhihu.com/people/liu-jie-84-52</a>
        æ¥ä¸‹æ¥æˆ‘ä»¬è¿›å…¥æ­£é¢˜ï¼Œå¦‚ä½•å®ç°ä¸€ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿã€‚

      </blockquote>

      <div style="text-align: center; width: 100%; border: black solid 1px;">
        <img src="./resources/arch.png" width="40%" style="display: inline-block; margin-bottom: 5%;"/>
      </div>

        <details open>
          <summary></summary>
          <ol>
            <li>
              <a href="#intro">MIT6.824 åˆ†å¸ƒå¼ç³»ç»Ÿç³»åˆ—</a>
              <ul>
                <li><a href="./index.html">ï¼ˆä¸€ï¼‰ä½“éªŒåˆ†å¸ƒå¼KVå­˜å‚¨ç³»ç»Ÿeraftkv </a></li>
                <li><a href="./ebook-ch2.html">ï¼ˆäºŒï¼‰Go è¯­è¨€åŸºç¡€çŸ¥è¯†</a></li>
                <li><a href="./ebook-ch3.html">ï¼ˆä¸‰ï¼‰Raft è®ºæ–‡è§£è¯» </a></li>
                <li><a href="./ebook-ch4.html">ï¼ˆå››ï¼‰æ„å»º Raft åº“                </a></li>
              </ul>
            </li>
          </ol>
        </details>

      <h2 id="intro"> MIT åˆ†å¸ƒå¼ç³»ç»Ÿï¼ˆä¸€ï¼‰æ„å»º Raft åº“   <a class="anchor" href="#intro">#</a></h2>

      <h3>
        æ ¸å¿ƒæ•°æ®ç»“æ„è®¾è®¡
      </h3>

      <p>
        æˆ‘ä»¬ä¸Šä¸€ç« èŠ‚è®²äº† Raft ç®—æ³•çš„ä¸»è¦å†…å®¹ï¼Œç°åœ¨æˆ‘ä»¬è¦ä»£ç å®ç°å®ƒä»¬äº†ã€‚é¦–å…ˆæˆ‘ä»¬éœ€è¦æŠ½è±¡å‡ºæˆ‘ä»¬éœ€è¦çš„æ•°æ®ç»“æ„ã€‚å…ˆæ¥æ¢³ç†ä¸€ä¸‹å¯èƒ½ç”¨åˆ°çš„æ•°æ®ç»“æ„ï¼Œé¦–å…ˆèŠ‚ç‚¹ä¹‹é—´éœ€è¦äº’ç›¸è®¿é—®ï¼Œé‚£æˆ‘ä»¬éœ€è¦å®šä¹‰è®¿é—®å…¶ä»–èŠ‚ç‚¹çš„ç½‘ç»œå®¢æˆ·ç«¯ï¼Œè¿™é‡Œé¢è¦åŒ…å«èŠ‚ç‚¹çš„ id, åœ°å€ï¼Œè¿˜æœ‰ rpc çš„å®¢æˆ·ç«¯ï¼Œæ•´ä¸ªç»“æ„æˆ‘ä»¬æŠ½è±¡ä¸º RaftClientEndï¼Œä¸»è¦æ•°æ®å†…å®¹å¦‚ä¸‹ï¼š
      </p>

      <blockquote>
        type RaftClientEnd struct { <br/>
            id             uint64<br/>
            addr           string<br/>
            raftServiceCli *raftpb.RaftServiceClient  // grpc å®¢æˆ·ç«¯
        }        
      </blockquote>
      <p>
        èŠ‚ç‚¹çŠ¶æ€æˆ‘ä»¬ä¹‹å‰æè¿°çš„æœ‰ä¸‰ç§ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š
      </p>

      <blockquote>
        const (<br/>
	NodeRoleFollower NodeRole = iota<br/>
	NodeRoleCandidate<br/>
	NodeRoleLeader<br/>
    )
      </blockquote>
      æˆ‘ä»¬è¦å®Œæˆé€‰ä¸¾æ“ä½œçš„è¯éœ€è¦ä¸¤ä¸ªè¶…æ—¶æ—¶é—´ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ Golang time åº“é‡Œé¢çš„ Timer å®ç°ï¼Œå®ƒå¯ä»¥å®šæ—¶çš„ç»™ä¸€ä¸ªé€šé“å‘é€æ¶ˆæ¯ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å®ç°é€‰ä¸¾è¶…æ—¶å’Œå¿ƒè·³è¶…æ—¶ã€‚

      <blockquote>
        electionTimer    *time.Timer<br/>
heartbeatTimer   *time.Timer<br/>
      </blockquote>
      é™¤æ­¤ä¹‹å¤–æˆ‘ä»¬è¿˜éœ€è¦è®°å½•å½“å‰èŠ‚ç‚¹çš„ id, å½“å‰çš„ä»»æœŸå·ï¼Œä¸ºè°æŠ•ç¥¨ï¼Œè·å¾—ç¥¨æ•°çš„ç»Ÿè®¡ï¼Œå·²ç»æäº¤çš„æ—¥å¿—ç´¢å¼•å·ï¼Œæœ€å apply åˆ°çŠ¶æ€æœºçš„æ—¥å¿—å·ï¼Œä»¥åŠèŠ‚ç‚¹å¦‚æœæ˜¯ Leader çš„è¯éœ€è¦è®°å½•åˆ°å…¶ä»–èŠ‚ç‚¹å¤åˆ¶æœ€æ–°åŒ¹é…çš„æ—¥å¿—å·ï¼Œè¿™å†™æ•°æ®ç»“æ„å®šä¹‰å¦‚ä¸‹ï¼š


      <blockquote>
        type Raft struct {<br/>
            mu             sync.RWMutex<br/>
            peers          []*RaftClientEnd // rpc å®¢æˆ·ç«¯<br/>
            me_            int  // è‡ªå·±çš„ id<br/>
            dead           int32 // èŠ‚ç‚¹çš„çŠ¶æ€<br/>
            applyCh        chan *pb.ApplyMsg // apply åç¨‹é€šé“ï¼Œåç¨‹æ¨¡å‹ä¸­ä¼šè®²åˆ°<br/>
            applyCond      *sync.Cond // apply æµç¨‹æ§åˆ¶çš„ä¿¡å·é‡<br/>
            replicatorCond []*sync.Cond // å¤åˆ¶æ“ä½œæ§åˆ¶çš„ä¿¡å·é‡<br/>
            role           NodeRole  // èŠ‚ç‚¹å½“å‰çš„çŠ¶æ€<br/>
            curTerm        int64  // å½“å‰çš„ä»»æœŸ<br/>
            votedFor       int64  // ä¸ºè°æŠ•ç¥¨<br/>
            grantedVotes   int    // å·²ç»è·å¾—çš„ç¥¨æ•° <br/>
            logs           *RaftLog  // æ—¥å¿—ä¿¡æ¯<br/>
            commitIdx      int64     // å·²ç»æäº¤çš„æœ€å¤§çš„æ—¥å¿— id<br/>
            lastApplied    int64     // å·²ç» apply çš„æœ€å¤§æ—¥å¿—çš„ id<br/>
            nextIdx        []int     // åˆ°å…¶ä»–èŠ‚ç‚¹ä¸‹ä¸€ä¸ªåŒ¹é…çš„æ—¥å¿— id ä¿¡æ¯<br/>
            matchIdx       []int     // åˆ°å…¶ä»–èŠ‚ç‚¹å½“å‰åŒ¹é…çš„æ—¥å¿— id ä¿¡æ¯<br/>
        
            leaderId         int64   // é›†ç¾¤ä¸­å½“å‰ Leader èŠ‚ç‚¹çš„ id<br/>
            electionTimer    *time.Timer  // é€‰ä¸¾è¶…æ—¶å®šæ—¶å™¨<br/>
            heartbeatTimer   *time.Timer  // å¿ƒè·³è¶…æ—¶å®šæ—¶å™¨<br/>
            heartBeatTimeout uint64       // å¿ƒè·³è¶…æ—¶æ—¶é—´<br/>
            baseElecTimeout  uint64       // é€‰ä¸¾è¶…æ—¶æ—¶é—´<br/>
        }
      </blockquote>
      é¦–å…ˆç³»ç»Ÿå¯åŠ¨çš„æ—¶å€™éœ€è¦æ„é€  Raft è¿™ä¸ªç»“æ„ä½“ï¼Œè¿™ä¸ªæµç¨‹æ˜¯åœ¨ MakeRaft é‡Œé¢å®ç°çš„ï¼Œå®ƒä¸»è¦æ˜¯åˆå§‹åŒ–ä¸ä¸€äº›å˜é‡ï¼Œä¸¤ä¸ªå®šæ—¶å™¨ï¼Œå¹¶å¯åŠ¨ç›¸å…³çš„åç¨‹ï¼Œæˆ‘ä»¬è¿™é‡Œå¯¹æ¯ä¸ªå¯¹ç«¯èŠ‚ç‚¹å¤åˆ¶æœ‰ Replicator åç¨‹ï¼Œè§¦å‘ä¸¤ä¸ªè¶…æ—¶æ—¶é—´æœ‰ Tick åç¨‹ï¼Œåº”ç”¨å·²ç»æäº¤çš„æ—¥å¿—æœ‰ Applier åç¨‹ã€‚

      <h3>
        åç¨‹æ¨¡å‹
      </h3>
      <div style="text-align: center; width: 100%; border: black solid 1px;">
        <img src="./resources/goruntine_model.svg" width="90%" style="display: inline-block; margin-bottom: 5%;"/>
      </div>

      <p>ä¸Šå›¾å±•ç¤ºäº†æˆ‘ä»¬ raftcore é‡Œé¢çš„åç¨‹æ¨¡å‹ï¼Œå½“åº”ç”¨å±‚ææ¡ˆ (propose) åˆ°æ¥ä¹‹åä¸»åç¨‹ä¼šåœ¨æœ¬åœ°è¿½åŠ æ—¥å¿—ï¼Œç„¶åå‘é€ BroadcastAppendï¼Œç„¶ååˆ°å…¶ä»–èŠ‚ç‚¹å¤åˆ¶æ—¥å¿—çš„åç¨‹çš„ç­‰å¾…å°±ä¼šè¢«å”¤é†’ï¼Œå¼€å§‹è¿›è¡Œä¸€è½®çš„çš„å¤åˆ¶ï¼ŒreplicateOneRound æˆåŠŸå¤åˆ¶åŠæ•°èŠ‚ç‚¹æ—¥å¿—ä¹‹åä¼šè§¦å‘ commit, rf.applyCond.Signal() ä¼šå”¤é†’ç­‰å¾…åš Apply æ“ä½œçš„ Applier åç¨‹ã€‚

    </p>

    <p>å¦å¤– Tick åç¨‹ä¼šç›‘å¬ Timer ä¸¤ä¸ªè¶…æ—¶çš„ C é€šé“ä¿¡å·ï¼Œä¸€æ—¦å¿ƒè·³è¶…æ—¶å¹¶ä¸”å½“å‰èŠ‚ç‚¹çš„çŠ¶æ€æ˜¯ Leaderï¼Œå°±ä¼šè°ƒç”¨ BroadcastHeartbeat å‘é€å¿ƒè·³ï¼Œå‘å¿ƒè·³çš„æ—¶å€™ä¹Ÿä¼š replicateOneRound å°±å’Œä¸Šè¿°ä¸€æ ·ï¼Œå¦‚æœæˆåŠŸå¤åˆ¶åŠæ•°èŠ‚ç‚¹æ—¥å¿—ä¹‹åä¼šè§¦å‘ commit, rf.applyCond.Signal() å°±ä¼šå”¤é†’ç­‰å¾…åš Apply æ“ä½œçš„ Applier åç¨‹ã€‚

    </p>

    <p>
        Applier åç¨‹ apply å®Œæ¶ˆæ¯ä¹‹åä¼šæŠŠ ApplyMsg æ¶ˆæ¯å†™å…¥ rf.applyCh é€šçŸ¥åº”ç”¨å±‚ï¼Œåº”ç”¨å±‚çš„åç¨‹å’Œä»¥ç›‘å¬è¿™ä¸ªé€šé“ï¼Œå¦‚æœæœ‰ ApplyMsg åˆ°æ¥å°±æŠŠå®ƒåº”ç”¨åˆ°çŠ¶æ€æœºã€‚ 
    </p>

    <h3>
        Rpc å®šä¹‰
    </h3>
    eraft çš„ rpc å®šä¹‰æ–‡ä»¶åœ¨ pbs ç›®å½•ä¸‹çš„ raftbasic.proto æ–‡ä»¶ä¸­ï¼Œä¸»è¦çš„æ¶ˆæ¯å¦‚ä¸‹ï¼š

    <br/>
    Entry

    <p>
        è¿™ä¸ªæ˜¯ä¸€ä¸ªæ—¥å¿—æ¡ç›®ä¿¡æ¯è¡¨ç¤ºï¼Œå’Œæˆ‘ä»¬ä¹‹å‰æè¿°çš„ä¸€æ ·ï¼Œå®ƒæœ‰ä»»æœŸå· termï¼Œç´¢å¼•å· index, ä»¥åŠæ“ä½œçš„åºåˆ—åŒ–æ•°æ® data æˆ‘ä»¬ç”¨ä¸€ä¸ªå­—èŠ‚æµæ¥å­˜å‚¨ï¼Œæ—¥å¿—æ¡ç›®æœ‰ä¸¤ç§ç±»å‹ä¸€ç§æ˜¯ Normal æ­£å¸¸æ—¥å¿—ï¼Œå¦ä¸€ç§æ˜¯ ConfChange é…ç½®å˜æ›´çš„æ—¥å¿—ï¼š
    </p>

    <blockquote>
        enum EntryType {<br/>
            EntryNormal = 0;<br/>
            EntryConfChange = 1;<br/>
        }<br/>
        <br/>
        message Entry {<br/>
            EntryType entry_type = 1;<br/>
            uint64    term = 2;<br/>
            int64     index = 3;<br/>
            bytes     data = 4;<br/>
        }
    </blockquote>

    <h3>
        RequestVote ç›¸å…³
    </h3>

    ä¸‹é¢æ˜¯è¯·æ±‚æŠ•ç¥¨ RPC çš„å®šä¹‰ï¼ŒåŸºæœ¬å’Œè®ºæ–‡é‡Œé¢ä¿æŒä¸€è‡´ï¼š
    <br/>
è¯·æ±‚æŠ•ç¥¨é‡Œé¢æœ‰å€™é€‰äººçš„ä»»æœŸå·ï¼Œå®ƒçš„ id ä»¥åŠå®ƒæœ€åä¸€æ¡æ—¥å¿—çš„ç´¢å¼•ä»¥åŠä»»æœŸå·ä¿¡æ¯ã€‚
<br/>
å“åº”é‡Œé¢æœ‰ä¸ªä»»æœŸå·ï¼Œè¿™ä¸ªç”¨æ¥ç»™å€™é€‰äººåœ¨é€‰ä¸¾å¤±è´¥çš„æ—¶å€™æ›´æ–°è‡ªå·±çš„ä»»æœŸï¼Œè¿˜æœ‰ä¸€ä¸ª vote_granted è¡¨ç¤ºè¿™ä¸ªè¯·æ±‚æŠ•ç¥¨æ“ä½œæ˜¯å¦è¢«å¯¹ç«¯èŠ‚ç‚¹æ¥å—ã€‚
<br/>

<blockquote>
    message RequestVoteRequest {<br/>
        int64 term = 1;<br/>
        int64 candidate_id = 2;<br/>
        int64 last_log_index = 3;<br/>
        int64 last_log_term = 4;<br/>
    }<br/>
    
    message RequestVoteResponse {<br/>
        int64 term = 1;<br/>
        bool  vote_granted = 2;<br/>
    }<br/>
    
    service RaftService {<br/>
        //...<br/>
        rpc RequestVote (RequestVoteRequest) returns (RequestVoteResponse) {}<br/>
    }<br/>
</blockquote>

<h3>
    AppendEntries ç›¸å…³
</h3>

<p>
    æ—¥å¿—è¿½åŠ æ“ä½œçš„å®šä¹‰å¦‚ä¸‹ï¼ŒåŸºæœ¬ä¹Ÿå’Œè®ºæ–‡é‡Œé¢ä¸€è‡´ï¼š
</p>

<p>
    è¯·æ±‚é‡Œé¢æœ‰ Leader çš„ä»»æœŸï¼Œid ï¼ˆç”¨æ¥å‘Šè¯‰ follower, è¿™æ · client è®¿é—®äº† follower ä¹‹åå¯ä»¥è¢«å‘ŠçŸ¥ leader èŠ‚ç‚¹æ˜¯å“ªä¸ªï¼‰ï¼Œ prev_log_index è¡¨ç¤ºæ¶ˆæ¯é‡Œé¢å°†è¦åŒæ­¥çš„ç¬¬ä¸€æ¡æ—¥å¿—å‰ä¸€æ¡æ—¥å¿—çš„çš„ç´¢å¼•ä¿¡æ¯ï¼Œprev_log_term æ˜¯å®ƒçš„ä»»æœŸä¿¡æ¯ï¼Œleader_commit åˆ™æ˜¯ leader çš„ commit å· (å¯ä»¥ç”¨æ¥å‘¨çŸ¥ follower èŠ‚ç‚¹å½“å‰çš„ commit è¿›åº¦)ï¼Œentries è¡¨ç¤ºæ—¥å¿—æ¡ç›®ä¿¡æ¯ã€‚
</p>

<p>
    å“åº”é‡Œé¢ term ç”¨æ¥å‘Šè¯‰ leader æ˜¯å¦å‡ºæ–°çš„ä»»æœŸçš„æ¶ˆæ¯ï¼Œå¯ä»¥ç”¨æ¥æ›´æ–° leader çš„ä»»æœŸå·ï¼Œsuccess è¡¨ç¤ºæ—¥å¿—è¿½åŠ æ“ä½œæ˜¯å¦æˆåŠŸï¼Œconflict_index ç”¨æ¥è®°å½•å†²çªæ—¥å¿—çš„ç´¢å¼•å·ï¼Œconflict_term ç”¨æ¥è®°å½•å†²çªæ—¥å¿—çš„ä»»æœŸå·ã€‚ 
</p>

<blockquote>

message AppendEntriesRequest {<br/>
    int64    term = 1;<br/>
    int64    leader_id = 2;<br/>
    int64    prev_log_index = 3;<br/>
    int64    prev_log_term = 4;<br/>
    int64    leader_commit = 5;<br/>
    repeated Entry entries = 6;<br/>
}<br/>

message AppendEntriesResponse {<br/>
    int64  term = 1;<br/>
    bool  success = 2;<br/>
    int64 conflict_index = 3;<br/>
    int64 conflict_term = 4;<br/>
}<br/>


service RaftService {<br/>
    //...<br/>
    rpc AppendEntries (AppendEntriesRequest) returns (AppendEntriesResponse) {}<br/>
}<br/>
</blockquote>

<h3>
    Leader é€‰ä¸¾å®ç°åˆ†æ
</h3>

<p>
    Raft å®˜ç½‘æä¾›äº†ä¸€ä¸ªç®—æ³•çš„åŠ¨æ€æ¼”ç¤ºåŠ¨ç”»ï¼Œæˆ‘ä»¬å…ˆæ¥ç›´è§‚æ„Ÿå—ä¸‹ Leader é€‰ä¸¾çš„æµç¨‹ï¼Œç„¶åç»“åˆä»£ç ä»‹ç»è¿™ä¸ªæµç¨‹ã€‚


</p>

<p>
    é¦–å…ˆ Raft ç®—æ³•ä¸­æœ‰ä¸¤ä¸ªè¶…æ—¶æ—¶é—´ç”¨æ¥æ§åˆ¶ç€ Leader é€‰ä¸¾çš„æµç¨‹ï¼Œé¦–å…ˆæ˜¯é€‰ä¸¾è¶…æ—¶ï¼Œè¿™ä¸ªæ˜¯ Candidate ç­‰å¾…å˜æˆ Leader çš„æ—¶é—´è·¨åº¦ï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†…è¿˜æ²¡è¢«é€‰æˆ Leader, è¿™ä¸ªè¶…æ—¶å®šæ—¶å™¨ä¼šè¢«é‡ç½®ã€‚æˆ‘ä»¬å‰é¢ä¹Ÿä»‹ç»è¿‡ï¼Œè¿™ä¸ªè¶…æ—¶æ—¶é—´è®¾ç½®ä¸€èˆ¬åœ¨ 150ms åˆ° 300ms ä¹‹é—´ã€‚
</p>

<div style="text-align: center; width: 100%; border: black solid 1px;">
    <img src="./resources/raft_elec001.png" width="90%" style="display: inline-block; margin-bottom: 5%;"/>
  </div>  
      <h3>æèµ 
      </h3>

      <p>
        æ•´ç†è¿™æœ¬ä¹¦è€—è´¹äº†æˆ‘ä»¬å¤§é‡çš„æ—¶é—´å’Œç²¾åŠ›ã€‚å¦‚æœä½ è§‰å¾—æœ‰å¸®åŠ©ï¼Œä¸€ç“¶çŸ¿æ³‰æ°´çš„ä»·æ ¼æ”¯æŒæˆ‘ä»¬ç»§ç»­è¾“å‡ºä¼˜è´¨çš„åˆ†å¸ƒå¼å­˜å‚¨çŸ¥è¯†ä½“ç³»ï¼Œ2.99Â¥ï¼Œæ„Ÿè°¢å¤§å®¶çš„æ”¯æŒã€‚
      </p>

      <div style="text-align: center; width: 100%; border: black solid 1px;">
        <img src="./resources/alipay.jpeg" width="200px" style="display: inline-block;"/>
      </div>

      <h3 id="license">å¼€æºåè®®<a class="anchor" href="#tags">#</a></h3>
      <p>ã€Œèµ«è¹ã€éµå¾ªMITåè®®å¼€æºã€‚</p>

      <!-- <footer class="heti-fn">
        <ol>
          <li id="fn-01">
            <a href="#ref-01" title="ç§»è‡³">^</a>
            CSS Resetï¼šæŒ‡ä»£ç±»ä¼¼Eric Meyer's Reset CSSçš„æ ·å¼é‡ç½®æ–¹æ¡ˆ
          </li>
          <li id="fn-02">
            <a href="#ref-02" title="ç§»è‡³">^</a>
            ã€Šä¸­æ–‡æ’ç‰ˆéœ€æ±‚ã€‹ï¼šhttps://w3c.github.io/clreq/
          </li>
          <li id="fn-03">
            <a href="#ref-03" title="ç§»è‡³">^</a>
            åœ¨å½“ä¸‹å‰ç«¯æŠ€æœ¯å°šä¸èƒ½å®Œç¾è§£å†³ä¸­è¥¿æ–‡æ··æ’é—´è·çš„æƒ…å†µä¸‹ï¼Œå¸¸è§çš„è¾“å…¥ä¹ æƒ¯æ˜¯æ‰‹åŠ¨åœ¨ä¸­è¥¿æ–‡é—´åŠ å…¥ç©ºæ ¼ï¼ˆhttps://github.com/vinta/pangu.jsï¼‰ã€‚è¿™æ ·åšçš„å¼Šç«¯ä¸€æ˜¯é—´è·ä¸å¯æ§ï¼ˆæœ‰æ—¶æ˜¾å¾—è¿‡å¤§ï¼‰ï¼ŒäºŒæ˜¯é€šè¿‡ç©ºæ ¼ç¬¦æ¥æ’ç‰ˆåªèƒ½ç®—æ— å¥ˆä¹‹ä¸¾ã€‚å¥½æ¶ˆæ¯æ˜¯åœ¨æœ€æ–°çš„macOSã€iOSä¸­ï¼Œä½¿ç”¨åŸç”Ÿè¯­è¨€å¼€å‘çš„æ–‡æœ¬åŒºåŸŸä¼šè‡ªåŠ¨å¤„ç†ä¸­è¥¿æ–‡æ··æ’çš„é—´è·ï¼ˆæ— è®ºæ˜¯å¦åŠ ç©ºæ ¼ï¼‰ï¼ŒæœŸå¾…ä¸ç”¨æ‰‹æ•²ç©ºæ ¼çš„æ—¥å­æ—©æ—¥åˆ°æ¥ã€‚
          </li>
        </ol>
      </footer> -->
      <script src="https://giscus.app/client.js"
      data-repo="eraft-io/eraft-io.github.io"
      data-repo-id="MDEwOlJlcG9zaXRvcnkzOTYyMDM3NjU="
      data-category="General"
      data-category-id="DIC_kwDOF52W9c4CRblA"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="bottom"
      data-theme="preferred_color_scheme"
      data-lang="zh-CN"
      crossorigin="anonymous"
      async>
  </script>

    </article>
  </main>




  <aside class="panel">
    <ul class="panel-list panel-list--gray">
      <li><input type="radio" class="J_fontStack" value="heti--classic" name="font" id="font-classic" checked><label for="font-classic">ä¼ ç»Ÿ</label></li>
      <li><input type="radio" class="J_fontStack" value="heti--sans" name="font" id="font-sans"><label for="font-sans">é»‘ä½“</label></li>
      <li><input type="radio" class="J_fontStack" value="heti--serif" name="font" id="font-serif"><label for="font-serif">å®‹ä½“</label></li>
    </ul>
    <ul class="panel-list panel-list--gray">
      <li><input type="radio" class="J_radioGrid" value="" name="grid" id="grid-disable" checked><label for="grid-disable">ç½‘æ ¼ï¼šå…³</label></li>
      <li><input type="radio" class="J_radioGrid" value="grid-24" name="grid" id="grid-24"><label for="grid-24">å¤§</label></li>
      <li><input type="radio" class="J_radioGrid" value="grid-12" name="grid" id="grid-12"><label for="grid-12">å°</label></li>
    </ul>
    <ul class="panel-list panel-list--gray panel-list--icon">
      <li><input type="radio" class="J_darkMode" value="auto" name="darkmode" id="darkmode-auto" checked><label for="darkmode-auto">ğŸŒ—</label></li>
      <li><input type="radio" class="J_darkMode" value="light" name="darkmode" id="darkmode-light"><label for="darkmode-light">ğŸŒ</label></li>
      <li><input type="radio" class="J_darkMode" value="dark" name="darkmode" id="darkmode-dark"><label for="darkmode-dark">ğŸŒ™</label></li>
    </ul>
  </aside>

  <script src="./heti-addon.js"></script>
  <script>
    const $$root = document.getElementsByTagName('html')[0]
    const $$main = document.getElementsByTagName('main')[0]
    const $$article = document.getElementsByTagName('article')[0]

    function addEventListeners(nodeList, event, fn) {
      [].forEach.call(nodeList, function(elm) {
        elm.addEventListener(event, fn, false)
      }, false)
    }

    addEventListeners(document.getElementsByClassName('J_darkMode'), 'change', function (e) {
      $$root.setAttribute('data-darkmode', e.target.value)
    })

    addEventListeners(document.getElementsByClassName('J_radioGrid'), 'change', function (e) {
      $$main.setAttribute('data-bg-grid', e.target.value)
    })

    addEventListeners(document.getElementsByClassName('J_fontStack'), 'change', function (e) {
      $$article.className = ['article', 'heti', e.target.value].join(' ')
    })

    const heti = new Heti('.article')
    heti.autoSpacing()
  </script>
</body>
</html>