<!DOCTYPE html>
<html lang="zh-Hans" data-darkmode="auto">
<head>
  <meta charset="UTF-8">
  <title>eraft开发组 - 解读国外优质计算机课程</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="./heti.css">
  <link rel="stylesheet" href="./index.css">
  <link rel="icon" href="./favicon.svg">
</head>
<body>
  <main class="container">
    <article class="article heti heti--classic">
      <h1 class="article__title">eraft开发组</h1>
      <blockquote>

        我们团队致力于解读国外优秀的分布式存储相关开源课程，下面是课程体系图
        我们始终坚信优秀的本科教学不应该是照本宣科以及应付考试，一门优秀的课程，应该具备让学生学会思考、动手实践、找到问题、反复试错、并解决问题的能力，同时应该尽量用最直白，最简单的语言传达关键的知识点。作为计算机工业界的工作者，我相信做课程和做技术一样，并不是越复杂越好，应该尽量的让设计出来的东西简单化。
        关注我们的最新动态，欢迎关注
        https://www.zhihu.com/people/liu-jie-84-52
        接下来我们进入正题，如何实现一个分布式系统。

      </blockquote>

      <!-- <nav class="article__nav heti-skip">
        <details open>
          <summary>目录</summary>
          <ol>
            <li><a href="#intro">介绍</a></li>
            <li><a href="#usage">使用方法</a></li>
            <li>
              <a href="#examples">效果演示</a>
              <ul>
                <li><a href="#example-ancient">古文</a></li>
                <li><a href="#example-verse">诗词</a></li>
                <li><a href="#example-annotation">行间注</a></li>
                <li><a href="#example-columns">多栏排版</a></li>
                <li><a href="#example-vertical">竖排排版</a></li>
              </ul>
            </li>
            <li><a href="#guidelines">设计原则</a></li>
            <li>
              <a href="#appendix">附录</a>
              <ol class="heti-list-latin">
                <li><a href="#compatibility">兼容性</a></li>
                <li><a href="#tags">标签示例表</a></li>
                <li><a href="#javascript">增强脚本</a></li>
                <li><a href="#license">开源协议</a></li>
              </ol>
            </li>
          </ol>
        </details>
      </nav> -->

      <h2 id="intro"> MIT 分布式系统（一）体验分布式 KV 存储系统 eraftkv  <a class="anchor" href="#intro">#</a></h2>
      <p>
        作为系列的开篇，我们将带着大家从顶层体验下分布式系统，我们将忽略系统实现的细节点，直观感受一个分布式系统所具备的能力。本书还是第一个版本，我们还在不断的校对完善中，评论区是放开的，欢迎大家讨论参与本书的优化。
      </p>

      <h3>安装 go 编译环境
      </h3>

      <p>
        首先我们需要在电脑上安装好 go 语言编译器，你可以在 https://go.dev/dl/ 官网下载对应你系统版本的安装包。 按指示 https://go.dev/doc/install 安装 golang 编译环境。
      </p>
      <h3>
        编译构建 eraftkv
      </h3>
      <p>
        执行以下命令 (确保你的机器上安装了 Go 语言编译器以及 git, make 等基础工具) 编译很简单，下载代码之后，进入根目录直接 make
      </p>

      <blockquote>
        git clone https://github.com/eraft-io/eraft.git -b mit6824_lab
        <br/>
        cd eraft
        <br/>
        make
      </blockquote>

      <h3>架构概览
      </h3>

      <p>

      在我们运行 eraftkv 之前我们先概览以下它的架构，以便于我们对于接下来运行的程序功能有清晰的认识。
      </p>

      <img src="resources/eraftdb_arch.png" width="80%"/>

      <p>
        eraftkv 作为一个分布式 kv 存储系统，其中包含的服务角色以及一些概念需要提前给大家介绍一下。
      </p>

      <h3>
        系统中的一些概念
      </h3>

      <p>
        1.bucket - 它是集群做数据管理的逻辑单元，一个分组的 ShardServer 服务可以负责多个 bucket 的数据。
        <br/>
        2.config table - 集群配置表，它主要维护了集群服务分组与 bucket 的映射关系，客户端访问集群数据之前需要先到这个表查询要访问 bucket 所在的服务分组列表。
      </p>

      <h3>
        系统中有三种角色
      </h3>

      <p>
        1.Client - 客户端，它是用户使用我们这个分布式的接入端。
        <br/>
        2.ConfigServer - 配置服务器，它是系统的配置管理中心，它存储了集群的路由配置信息。
        <br/>
        3.ShardServer - 数据服务器，它是系统中实际存储用户数据的服务器。
      </p>

      <h3> 请求处理流程
       </h3>

       <p>

        看了架构概览，大家可能有觉得概念有些模糊，我们接下来就分析一个具体的请求示例，看看这个分布式系统是如何工作起来的。
        <br/>

例如现在客户端来了一个 put testkey testvalue 的请求：
<br/>

1.客户端程序启动运行的时候会从 ConfigServer 获取到最新的路由信息表。
<br/>

2.put testkey testvalue 操作首先会计算 testkey 的 CRC32 哈希值对集群中的 bucket 数取模算到这个 key 命中了哪个 bucket。
<br/>

3.之后客户端将 put 请求内容打包成一个 rpc 请求包，发送到集群配置表中负责这个 bucket 的 ShardServer 服务分组。
<br/>

4.Leader ShardServer 服务收到这个 rpc 请求后并不是直接写入存储引擎，而是构造一个 raft 提案，提交到 raft 状态机，当分组中半数节点以上的 ShardServer 都同意这个操作后 (如果你没有接触过分布式一致性算法，这里可以先不用理解细节，我们会在 Raft 论文解读一章详细解读为什么要这样做)，作为 Leader 的 ShardServer 服务器才能返回给客户端写入成功。

       </p>

       <h3>
        让系统跑起来，体验它！
       </h3>

       <p>
        前面我们构建完 eraftkv 之后，在 eraft 目录有一个 output 文件夹，里面有我们需要运行的 bin 文件。
       </p>


       <blockquote>
        colin@B-M1-0045 eraft % ls -l output 
        <br/>

        total 124120
        <br/>

        -rwxr-xr-x  1 colin  staff  12119296  5 25 20:40 bench_cli
        <br/>

        -rwxr-xr-x  1 colin  staff  12114784  5 25 20:40 cfgcli
        <br/>

        -rwxr-xr-x  1 colin  staff  13578848  5 25 20:40 cfgserver
        <br/>

        -rwxr-xr-x  1 colin  staff  12127328  5 25 20:40 shardcli
        <br/>

        -rwxr-xr-x  1 colin  staff  13600368  5 25 20:40 shardserver
       </blockquote>

       <h3>
        可执行文件介绍
       </h3>

       <p>
        1.cfgserver
        <br/>

        ConfigServer 的可执行文件，系统的配置管理中心，需要首先启动
        <br/>

        2.cfgcli
        <br/>

        ConfigServer 的客户端工具，它和 ConfigServer 交互用来管理集群的配置
        <br/>

        3.shardserver
        <br/>

        ShardServer 的可执行文件，它负责存储用户的数据
        <br/>

        4.shardcli
        <br/>

        ShardServer 的客户端工具，用户可以使用它向集群中写入数据
        <br/>

        5.bench_cli
        <br/>

        系统的性能测试工具
      </p>

      <h3>
        启动服务
      </h3>

      <p>
        1.启动配置服务器分组
      </p>

      <blockquote>
        ./cfgserver 0 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090
        <br/>
        ./cfgserver 1 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090
        <br/>
        ./cfgserver 2 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090
      </blockquote>
      <p>
        2.初始化集群配置
      </p>

      <blockquote>
        ./cfgcli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 
        <br/>
    join 1 127.0.0.1:6088,127.0.0.1:6089,127.0.0.1:6090
    <br/>
./cfgcli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 join 2  127.0.0.1:7088,127.0.0.1:7089,127.0.0.1:7090
<br/>
./cfgcli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 move 0-4 1
 <br/>
./cfgcli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 move 5-9 2
      </blockquote>

      <p>
        3.启动数据服务器分组
      </p>

      <blockquote>

./shardserver 0 1 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 127.0.0.1:6088,127.0.0.1:6089,127.0.0.1:6090
<br/>

./shardserver 1 1 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 127.0.0.1:6088,127.0.0.1:6089,127.0.0.1:6090
<br/>

./shardserver 2 1 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 127.0.0.1:6088,127.0.0.1:6089,127.0.0.1:6090
<br/>


./shardserver 0 2 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 127.0.0.1:7088,127.0.0.1:7089,127.0.0.1:7090
<br/>


./shardserver 1 2 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 127.0.0.1:7088,127.0.0.1:7089,127.0.0.1:7090
<br/>

./shardserver 2 2 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090
127.0.0.1:7088,127.0.0.1:7089,127.0.0.1:7090

      </blockquote>

      <p>
        4.读写数据
      </p>

      <blockquote>
        ./shardcli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 put  testkey testvalue
<br/>

./shardcli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 get testkey

      </blockquote>

      <p>
        5.运行基准测试
      </p>
      <blockquote>
        ./bench_cli 127.0.0.1:8088,127.0.0.1:8089,127.0.0.1:8090 100 put
      </blockquote>

      <h3>捐赠
      </h3>

      <p>
        整理这本书耗费了我们大量的时间和精力。如果你觉得有帮助，一瓶矿泉水的价格支持我们继续输出优质的分布式存储知识体系，2.99¥，感谢大家的支持。
      </p>

      <div style="text-align: center; width: 100%; border: black solid 1px;">
        <img src="./resources/alipay.jpeg" width="200px" style="display: inline-block;"/>
      </div>

      <h3 id="license">开源协议<a class="anchor" href="#tags">#</a></h3>
      <p>「赫蹏」遵循MIT协议开源。</p>

      <!-- <footer class="heti-fn">
        <ol>
          <li id="fn-01">
            <a href="#ref-01" title="移至">^</a>
            CSS Reset：指代类似Eric Meyer's Reset CSS的样式重置方案
          </li>
          <li id="fn-02">
            <a href="#ref-02" title="移至">^</a>
            《中文排版需求》：https://w3c.github.io/clreq/
          </li>
          <li id="fn-03">
            <a href="#ref-03" title="移至">^</a>
            在当下前端技术尚不能完美解决中西文混排间距的情况下，常见的输入习惯是手动在中西文间加入空格（https://github.com/vinta/pangu.js）。这样做的弊端一是间距不可控（有时显得过大），二是通过空格符来排版只能算无奈之举。好消息是在最新的macOS、iOS中，使用原生语言开发的文本区域会自动处理中西文混排的间距（无论是否加空格），期待不用手敲空格的日子早日到来。
          </li>
        </ol>
      </footer> -->
      <script src="https://giscus.app/client.js"
      data-repo="eraft-io/eraft-io.github.io"
      data-repo-id="MDEwOlJlcG9zaXRvcnkzOTYyMDM3NjU="
      data-category="General"
      data-category-id="DIC_kwDOF52W9c4CRblA"
      data-mapping="pathname"
      data-strict="0"
      data-reactions-enabled="1"
      data-emit-metadata="0"
      data-input-position="bottom"
      data-theme="preferred_color_scheme"
      data-lang="zh-CN"
      crossorigin="anonymous"
      async>
  </script>
  
    </article>
  </main>




  <aside class="panel">
    <ul class="panel-list panel-list--gray">
      <li><input type="radio" class="J_fontStack" value="heti--classic" name="font" id="font-classic" checked><label for="font-classic">传统</label></li>
      <li><input type="radio" class="J_fontStack" value="heti--sans" name="font" id="font-sans"><label for="font-sans">黑体</label></li>
      <li><input type="radio" class="J_fontStack" value="heti--serif" name="font" id="font-serif"><label for="font-serif">宋体</label></li>
    </ul>
    <ul class="panel-list panel-list--gray">
      <li><input type="radio" class="J_radioGrid" value="" name="grid" id="grid-disable" checked><label for="grid-disable">网格：关</label></li>
      <li><input type="radio" class="J_radioGrid" value="grid-24" name="grid" id="grid-24"><label for="grid-24">大</label></li>
      <li><input type="radio" class="J_radioGrid" value="grid-12" name="grid" id="grid-12"><label for="grid-12">小</label></li>
    </ul>
    <ul class="panel-list panel-list--gray panel-list--icon">
      <li><input type="radio" class="J_darkMode" value="auto" name="darkmode" id="darkmode-auto" checked><label for="darkmode-auto">🌗</label></li>
      <li><input type="radio" class="J_darkMode" value="light" name="darkmode" id="darkmode-light"><label for="darkmode-light">🌞</label></li>
      <li><input type="radio" class="J_darkMode" value="dark" name="darkmode" id="darkmode-dark"><label for="darkmode-dark">🌙</label></li>
    </ul>
  </aside>

  <script src="./heti-addon.js"></script>
  <script>
    const $$root = document.getElementsByTagName('html')[0]
    const $$main = document.getElementsByTagName('main')[0]
    const $$article = document.getElementsByTagName('article')[0]

    function addEventListeners(nodeList, event, fn) {
      [].forEach.call(nodeList, function(elm) {
        elm.addEventListener(event, fn, false)
      }, false)
    }

    addEventListeners(document.getElementsByClassName('J_darkMode'), 'change', function (e) {
      $$root.setAttribute('data-darkmode', e.target.value)
    })

    addEventListeners(document.getElementsByClassName('J_radioGrid'), 'change', function (e) {
      $$main.setAttribute('data-bg-grid', e.target.value)
    })

    addEventListeners(document.getElementsByClassName('J_fontStack'), 'change', function (e) {
      $$article.className = ['article', 'heti', e.target.value].join(' ')
    })

    const heti = new Heti('.article')
    heti.autoSpacing()
  </script>
</body>
</html>