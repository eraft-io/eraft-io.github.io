
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>第十七讲 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="LEC18.html" />
    
    
    <link rel="prev" href="LEC16.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    关于这个小本子
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../CONTRIBUTION.html">
            
                <a href="../CONTRIBUTION.html">
            
                    
                    如何贡献
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    cmu15455 Introduction to DataBase Systems
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="LEC1.html">
            
                <a href="LEC1.html">
            
                    
                    第一讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="LEC2.html">
            
                <a href="LEC2.html">
            
                    
                    第二讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="LEC3.html">
            
                <a href="LEC3.html">
            
                    
                    第三讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="LEC4.html">
            
                <a href="LEC4.html">
            
                    
                    第四讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="LEC5.html">
            
                <a href="LEC5.html">
            
                    
                    第五讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="LEC6.html">
            
                <a href="LEC6.html">
            
                    
                    第六讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="LEC7.html">
            
                <a href="LEC7.html">
            
                    
                    第七讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="LEC8.html">
            
                <a href="LEC8.html">
            
                    
                    第八讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="LEC9.html">
            
                <a href="LEC9.html">
            
                    
                    第九讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="LEC10.html">
            
                <a href="LEC10.html">
            
                    
                    第十讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.11" data-path="LEC11.html">
            
                <a href="LEC11.html">
            
                    
                    第十一讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.12" data-path="LEC12.html">
            
                <a href="LEC12.html">
            
                    
                    第十二讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.13" data-path="LEC13.html">
            
                <a href="LEC13.html">
            
                    
                    第十三讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.14" data-path="LEC14.html">
            
                <a href="LEC14.html">
            
                    
                    第十四讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.15" data-path="LEC15.html">
            
                <a href="LEC15.html">
            
                    
                    第十五讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.16" data-path="LEC16.html">
            
                <a href="LEC16.html">
            
                    
                    第十六讲
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.17" data-path="LEC17.html">
            
                <a href="LEC17.html">
            
                    
                    第十七讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.18" data-path="LEC18.html">
            
                <a href="LEC18.html">
            
                    
                    第十八讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.19" data-path="LEC19.html">
            
                <a href="LEC19.html">
            
                    
                    第十九讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.20" data-path="LEC20.html">
            
                <a href="LEC20.html">
            
                    
                    第二十讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.21" data-path="LEC21.html">
            
                <a href="LEC21.html">
            
                    
                    第二一讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.22" data-path="LEC22.html">
            
                <a href="LEC22.html">
            
                    
                    第二二讲
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    cmu15-213 Introdution to Computer Systems
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../cmu15213/LEC1.html">
            
                <a href="../cmu15213/LEC1.html">
            
                    
                    第一讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../cmu15213/LEC2.html">
            
                <a href="../cmu15213/LEC2.html">
            
                    
                    第二讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../cmu15213/LEC3.html">
            
                <a href="../cmu15213/LEC3.html">
            
                    
                    第三讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../cmu15213/LEC4.html">
            
                <a href="../cmu15213/LEC4.html">
            
                    
                    第四讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../cmu15213/LEC5.html">
            
                <a href="../cmu15213/LEC5.html">
            
                    
                    第五讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../cmu15213/LEC6.html">
            
                <a href="../cmu15213/LEC6.html">
            
                    
                    第六讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../cmu15213/LEC7.html">
            
                <a href="../cmu15213/LEC7.html">
            
                    
                    第七讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../cmu15213/LEC8.html">
            
                <a href="../cmu15213/LEC8.html">
            
                    
                    第八讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../cmu15213/LEC9.html">
            
                <a href="../cmu15213/LEC9.html">
            
                    
                    第九讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../cmu15213/LEC10.html">
            
                <a href="../cmu15213/LEC10.html">
            
                    
                    第十讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="../cmu15213/LEC11.html">
            
                <a href="../cmu15213/LEC11.html">
            
                    
                    第十一讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.12" data-path="../cmu15213/LEC12.html">
            
                <a href="../cmu15213/LEC12.html">
            
                    
                    第十二讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.13" data-path="../cmu15213/LEC13.html">
            
                <a href="../cmu15213/LEC13.html">
            
                    
                    第十三讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.14" data-path="../cmu15213/LEC14.html">
            
                <a href="../cmu15213/LEC14.html">
            
                    
                    第十四讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.15" data-path="../cmu15213/LEC15.html">
            
                <a href="../cmu15213/LEC15.html">
            
                    
                    第十五讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.16" data-path="../cmu15213/LEC16.html">
            
                <a href="../cmu15213/LEC16.html">
            
                    
                    第十六讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.17" data-path="../cmu15213/LEC17.html">
            
                <a href="../cmu15213/LEC17.html">
            
                    
                    第十七讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.18" data-path="../cmu15213/LEC18.html">
            
                <a href="../cmu15213/LEC18.html">
            
                    
                    第十八讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.19" data-path="../cmu15213/LEC19.html">
            
                <a href="../cmu15213/LEC19.html">
            
                    
                    第十九讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.20" data-path="../cmu15213/LEC20.html">
            
                <a href="../cmu15213/LEC20.html">
            
                    
                    第二十讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.21" data-path="../cmu15213/LEC21.html">
            
                <a href="../cmu15213/LEC21.html">
            
                    
                    第二一讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.22" data-path="../cmu15213/LEC22.html">
            
                <a href="../cmu15213/LEC22.html">
            
                    
                    第二二讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.23" data-path="../cmu15213/LEC23.html">
            
                <a href="../cmu15213/LEC23.html">
            
                    
                    第二三讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.24" data-path="../cmu15213/LEC24.html">
            
                <a href="../cmu15213/LEC24.html">
            
                    
                    第二四讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.25" data-path="../cmu15213/LEC25.html">
            
                <a href="../cmu15213/LEC25.html">
            
                    
                    第二五讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.26" data-path="../cmu15213/LEC26.html">
            
                <a href="../cmu15213/LEC26.html">
            
                    
                    第二六讲
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    cs106L Stanford C++
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="../cs106L/LEC1.html">
            
                <a href="../cs106L/LEC1.html">
            
                    
                    第一讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="../cs106L/LEC2.html">
            
                <a href="../cs106L/LEC2.html">
            
                    
                    第二讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="../cs106L/LEC3.html">
            
                <a href="../cs106L/LEC3.html">
            
                    
                    第三讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="../cs106L/LEC4.html">
            
                <a href="../cs106L/LEC4.html">
            
                    
                    第四讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="../cs106L/LEC5.html">
            
                <a href="../cs106L/LEC5.html">
            
                    
                    第五讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="../cs106L/LEC6.html">
            
                <a href="../cs106L/LEC6.html">
            
                    
                    第六讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="../cs106L/LEC7.html">
            
                <a href="../cs106L/LEC7.html">
            
                    
                    第七讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="../cs106L/LEC8.html">
            
                <a href="../cs106L/LEC8.html">
            
                    
                    第八讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="../cs106L/LEC9.html">
            
                <a href="../cs106L/LEC9.html">
            
                    
                    第九讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="../cs106L/LEC10.html">
            
                <a href="../cs106L/LEC10.html">
            
                    
                    第十讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.11" data-path="../cs106L/LEC11.html">
            
                <a href="../cs106L/LEC11.html">
            
                    
                    第十一讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.12" data-path="../cs106L/LEC12.html">
            
                <a href="../cs106L/LEC12.html">
            
                    
                    第十二讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.13" data-path="../cs106L/LEC13.html">
            
                <a href="../cs106L/LEC13.html">
            
                    
                    第十三讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.14" data-path="../cs106L/LEC14.html">
            
                <a href="../cs106L/LEC14.html">
            
                    
                    第十四讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.15" data-path="../cs106L/LEC15.html">
            
                <a href="../cs106L/LEC15.html">
            
                    
                    第十五讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.16" data-path="../cs106L/LEC16.html">
            
                <a href="../cs106L/LEC16.html">
            
                    
                    第十六讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.17" data-path="../cs106L/LEC17.html">
            
                <a href="../cs106L/LEC17.html">
            
                    
                    第十七讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.18" data-path="../cs106L/LEC18.html">
            
                <a href="../cs106L/LEC18.html">
            
                    
                    第十八讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.19" data-path="../cs106L/LEC19.html">
            
                <a href="../cs106L/LEC19.html">
            
                    
                    第十九讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.20" data-path="../cs106L/LEC20.html">
            
                <a href="../cs106L/LEC20.html">
            
                    
                    第二十讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.21" data-path="../cs106L/LEC21.html">
            
                <a href="../cs106L/LEC21.html">
            
                    
                    第二一讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.22" data-path="../cs106L/LEC22.html">
            
                <a href="../cs106L/LEC22.html">
            
                    
                    第二二讲
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    mit6.824 Distributed Systems
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" data-path="../mit6824/LEC1.html">
            
                <a href="../mit6824/LEC1.html">
            
                    
                    第一讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../mit6824/LEC2.html">
            
                <a href="../mit6824/LEC2.html">
            
                    
                    第二讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../mit6824/LEC3.html">
            
                <a href="../mit6824/LEC3.html">
            
                    
                    第三讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../mit6824/LEC4.html">
            
                <a href="../mit6824/LEC4.html">
            
                    
                    第四讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../mit6824/LEC5.html">
            
                <a href="../mit6824/LEC5.html">
            
                    
                    第五讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../mit6824/LEC6.html">
            
                <a href="../mit6824/LEC6.html">
            
                    
                    第六讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../mit6824/LEC7.html">
            
                <a href="../mit6824/LEC7.html">
            
                    
                    第七讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../mit6824/LEC8.html">
            
                <a href="../mit6824/LEC8.html">
            
                    
                    第八讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../mit6824/LEC9.html">
            
                <a href="../mit6824/LEC9.html">
            
                    
                    第九讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../mit6824/LEC10.html">
            
                <a href="../mit6824/LEC10.html">
            
                    
                    第十讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../mit6824/LEC11.html">
            
                <a href="../mit6824/LEC11.html">
            
                    
                    第十一讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../mit6824/LEC12.html">
            
                <a href="../mit6824/LEC12.html">
            
                    
                    第十二讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../mit6824/LEC13.html">
            
                <a href="../mit6824/LEC13.html">
            
                    
                    第十三讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../mit6824/LEC14.html">
            
                <a href="../mit6824/LEC14.html">
            
                    
                    第十四讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../mit6824/LEC15.html">
            
                <a href="../mit6824/LEC15.html">
            
                    
                    第十五讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../mit6824/LEC16.html">
            
                <a href="../mit6824/LEC16.html">
            
                    
                    第十六讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="../mit6824/LEC17.html">
            
                <a href="../mit6824/LEC17.html">
            
                    
                    第十七讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="../mit6824/LEC18.html">
            
                <a href="../mit6824/LEC18.html">
            
                    
                    第十八讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="../mit6824/LEC19.html">
            
                <a href="../mit6824/LEC19.html">
            
                    
                    第十九讲
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.20" data-path="../mit6824/LEC20.html">
            
                <a href="../mit6824/LEC20.html">
            
                    
                    第二十讲
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >第十七讲</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="lecture-17-two-phase-locking--&#x4E24;&#x9636;&#x6BB5;&#x9501;&#x534F;&#x8BAE;">Lecture 17: Two-Phase Locking  &#x4E24;&#x9636;&#x6BB5;&#x9501;&#x534F;&#x8BAE;</h1>
<h2 id="transaction-locks">Transaction Locks</h2>
<p>The DBMS contains a centralized lock manager that decides decisions whether a transaction can have a lock or not. It has a global view of whats going on inside the system.</p>
<p>&#x6570;&#x636E;&#x5E93;&#x7BA1;&#x7406;&#x7CFB;&#x7EDF;&#x5305;&#x542B;&#x4E00;&#x4E2A;&#x96C6;&#x4E2D;&#x7684;&#x9501;&#x7BA1;&#x7406;&#x5668;&#xFF0C;&#x5B83;&#x51B3;&#x5B9A;&#x4E8B;&#x52A1;&#x662F;&#x5426;&#x53EF;&#x4EE5;&#x6709;&#x9501;&#x3002;&#x5E76;&#x4E14;&#x5BF9;&#x7CFB;&#x7EDF;&#x5185;&#x90E8;&#x53D1;&#x751F;&#x7684;&#x4E8B;&#x60C5;&#x6709;&#x4E00;&#x4E2A;&#x5168;&#x5C40;&#x7684;&#x89C6;&#x56FE;&#x3002;</p>
<ul>
<li><p>Shared Lock (S-LOCK): A lock that allows multiple transactions to read the same object at the same time. If one transaction holds a shared lock, then another transaction can also acquire that same shared lock.</p>
</li>
<li><p>&#x5171;&#x4EAB;&#x9501;&#xFF08;S&#x9501;&#xFF09;&#xFF1A;&#x5B83;&#x5141;&#x8BB8;&#x591A;&#x4E2A;&#x4E8B;&#x52A1;&#x540C;&#x65F6;&#x8BFB;&#x53D6;&#x540C;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x7684;&#x9501;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x6301;&#x6709;&#x5171;&#x4EAB;&#x9501;&#xFF0C;&#x90A3;&#x4E48;&#x53E6;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x4E5F;&#x53EF;&#x4EE5;&#x83B7;&#x53D6;&#x76F8;&#x540C;&#x7684;&#x5171;&#x4EAB;&#x9501;&#x3002;</p>
</li>
<li><p>Exclusive Lock (X-LOCK): Allows a transaction to modify an object. This lock is not compatible for any other lock. Only one transaction can hold an exclusive lock at a time.</p>
</li>
<li><p>&#x72EC;&#x5360;&#x9501;&#xFF08;X&#x9501;&#xFF09;&#xFF1A;&#x5141;&#x8BB8;&#x4E8B;&#x52A1;&#x4FEE;&#x6539;&#x5BF9;&#x8C61;&#x3002;&#x8FD9;&#x4E2A;&#x9501;&#x4E0D;&#x4E0E;&#x4EFB;&#x4F55;&#x5176;&#x4ED6;&#x7684;&#x9501;&#x517C;&#x5BB9;&#xFF0C;&#x5E76;&#x4E14;&#x4E00;&#x6B21;&#x53EA;&#x80FD;&#x6709;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x6301;&#x6709;&#x8BE5;&#x9501;&#x3002;</p>
</li>
</ul>
<p>Executing with locks:</p>
<p>&#x4F7F;&#x7528;&#x9501;&#x6765;&#x6267;&#x884C;&#x4E8B;&#x52A1;&#x7684;&#x6D41;&#x7A0B;&#xFF1A;</p>
<ol>
<li><p>Transactions request locks (or upgrades) from the lock manager.</p>
</li>
<li><p>&#x4E8B;&#x52A1;&#x4ECE;&#x9501;&#x7BA1;&#x7406;&#x5668;&#x83B7;&#x53D6;&#x9501;</p>
</li>
<li><p>The lock manager grants or blocks requests based on what locks are currently held by other transactions.</p>
</li>
<li><p>&#x9501;&#x7BA1;&#x7406;&#x5668;&#x6839;&#x636E;&#x5176;&#x4ED6;&#x4E8B;&#x52A1;&#x5F53;&#x524D;&#x6301;&#x6709;&#x7684;&#x9501;&#x6765;&#x63A7;&#x5236;&#x5F53;&#x524D;&#x8BF7;&#x6C42;&#x662F;&#x5E94;&#x8BE5;&#x88AB;&#x963B;&#x585E;&#x4F4F;&#x8FD8;&#x662F;&#x7EE7;&#x7EED;&#x6267;&#x884C;</p>
</li>
<li><p>Transactions release locks when they no longer need them.</p>
</li>
<li><p>&#x4E8B;&#x52A1;&#x5728;&#x4E0D;&#x5728;&#x9700;&#x8981;&#x9501;&#x7684;&#x65F6;&#x5019;&#x91CA;&#x653E;&#x5B83;&#x6301;&#x6709;&#x7684;&#x9501;</p>
</li>
<li><p>The lock manager updates its internal lock-table and then gives locks to waiting transactions.</p>
</li>
<li><p>&#x9501;&#x7BA1;&#x7406;&#x5668;&#x66F4;&#x65B0;&#x5176;&#x5185;&#x90E8;&#x9501;&#x8868;&#xFF0C;&#x7136;&#x540E;&#x4E3A;&#x6B63;&#x5728;&#x7B49;&#x5F85;&#x7684;&#x4E8B;&#x52A1;&#x63D0;&#x4F9B;&#x9501;</p>
</li>
</ol>
<h1 id="two-phase-locking--&#x4E24;&#x9636;&#x6BB5;&#x9501;&#x534F;&#x8BAE;">Two-Phase Locking  &#x4E24;&#x9636;&#x6BB5;&#x9501;&#x534F;&#x8BAE;</h1>
<p>Two-Phase locking (2PL) is a pessimistic concurrency control protocol that determines whether a transaction is allowed to access an object in the database on the fly. The protocol does not need to know all of the queries that a transaction will execute ahead of time.</p>
<p>&#x4E24;&#x9636;&#x6BB5;&#x9501;&#x5B9A;&#xFF08;2PL&#xFF09;&#x662F;&#x4E00;&#x79CD;&#x60B2;&#x89C2;&#x7684;&#x5E76;&#x53D1;&#x63A7;&#x5236;&#x534F;&#x8BAE;&#xFF0C;&#x7528;&#x4E8E;&#x786E;&#x5B9A;&#x662F;&#x5426;&#x5141;&#x8BB8;&#x4E8B;&#x52A1;&#x52A8;&#x6001;&#x7684;&#x8BBF;&#x95EE;&#x6570;&#x636E;&#x5E93;&#x4E2D;&#x7684;&#x5BF9;&#x8C61;&#x3002;&#x8BE5;&#x534F;&#x8BAE;&#x4E0D;&#x9700;&#x8981;&#x63D0;&#x524D;&#x77E5;&#x9053;&#x4E8B;&#x52A1;&#x5C06;&#x6267;&#x884C;&#x7684;&#x6240;&#x6709;&#x67E5;&#x8BE2;&#x3002;</p>
<p>Phase 1: Growing</p>
<p>&#x9636;&#x6BB5;1&#xFF1A;&#x589E;&#x957F;&#xFF0C;&#x589E;&#x52A0;&#x9501;&#x7684;&#x6301;&#x6709;</p>
<p>&#x2022; Each transaction requests the locks that it needs from the DBMS&#x2019;s lock manager.</p>
<p>&#x2022; &#x6BCF;&#x4E2A;&#x4E8B;&#x52A1;&#x90FD;&#x5411; DBMS &#x7684;&#x9501;&#x7BA1;&#x7406;&#x5668;&#x8BF7;&#x6C42;&#x5B83;&#x9700;&#x8981;&#x7684;&#x9501;</p>
<p>&#x2022; The lock manager grants/denies lock requests.</p>
<p>&#x2022; &#x9501;&#x7BA1;&#x7406;&#x5668;&#x6388;&#x4E88;/&#x62D2;&#x7EDD;&#x9501;&#x8BF7;&#x6C42;</p>
<p>Phase 2: Shrinking</p>
<p>&#x9636;&#x6BB5; 2&#xFF1A;&#x6536;&#x7F29;&#xFF0C;&#x91CA;&#x653E;&#x9501;&#x7684;&#x6301;&#x6709;</p>
<p>&#x2022; The transaction enters this phase immediately after it releases its first lock.</p>
<p>&#x2022; &#x4E8B;&#x52A1;&#x5728;&#x91CA;&#x653E;&#x7B2C;&#x4E00;&#x4E2A;&#x9501;&#x540E;&#x7ACB;&#x5373;&#x8FDB;&#x5165;&#x6B64;&#x9636;&#x6BB5;</p>
<p>&#x2022; The transaction is allowed to only release locks that it previously acquired. It cannot acquire new locks in this phase.</p>
<p>&#x2022; &#x4E8B;&#x52A1;&#x53EA;&#x5141;&#x8BB8;&#x91CA;&#x653E;&#x5B83;&#x4E4B;&#x524D;&#x83B7;&#x5F97;&#x7684;&#x9501;&#xFF0C;&#x5728;&#x8FD9;&#x4E2A;&#x9636;&#x6BB5;&#x5B83;&#x4E0D;&#x80FD;&#x83B7;&#x53D6;&#x65B0;&#x7684;&#x9501;</p>
<p>On its own, 2PL is sufficient to guarantee conflict serializability. It generates schedules whose precedence graph is acyclic. But it is susceptible to cascading aborts, which is when a transaction aborts and now another transaction must be rolled back, which results in wasted work.</p>
<p>&#x5C31;&#x5176;&#x672C;&#x8EAB;&#x800C;&#x8A00;&#xFF0C;2PL &#x8DB3;&#x4EE5;&#x4FDD;&#x8BC1;&#x51B2;&#x7A81;&#x7684;&#x53EF;&#x4E32;&#x884C;&#x5316;&#x3002;&#x5B83;&#x751F;&#x6210;&#x4F18;&#x5148;&#x7EA7;&#x56FE;&#x662F;&#x975E;&#x5FAA;&#x73AF;&#x7684;&#x8C03;&#x5EA6;&#x3002;&#x4F46;&#x662F;&#x5B83;&#x5BB9;&#x6613;&#x53D7;&#x5230;&#x7EA7;&#x8054;&#x4E2D;&#x6B62;&#x7684;&#x5F71;&#x54CD;&#xFF0C;&#x5373;&#x5F53;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x51FA;&#x73B0;&#x4E2D;&#x6B62;&#x7684;&#x65F6;&#x5019;&#x5B81;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x4E5F;&#x5FC5;&#x987B;&#x56DE;&#x6EDA;&#xFF0C;&#x8FD9;&#x4F1A;&#x5BFC;&#x81F4;&#x5F88;&#x591A;&#x4EFB;&#x52A1;&#x767D;&#x505A;&#x4E86;&#x3002;</p>
<p>There are also potential schedules that are serializable but would not be allowed by 2PL (locking can limit concurrency).</p>
<p>&#x6709;&#x4E00;&#x4E9B;&#x6F5C;&#x5728;&#x7684;&#x8C03;&#x5EA6;&#x5BA4;&#x53EF;&#x5E8F;&#x5217;&#x5316;&#x7684;&#xFF0C;&#x4F46;&#x662F; 2PL &#x4E0D;&#x5141;&#x8BB8;&#xFF08;&#x9501;&#x4F1A;&#x9650;&#x5236;&#x5E76;&#x53D1;&#xFF09;</p>
<h2 id="strong-strict-two-phase-locking--&#x4E25;&#x683C;&#x7684;&#x4E24;&#x9636;&#x6BB5;&#x9501;&#x5B9A;">Strong Strict Two-Phase Locking  &#x4E25;&#x683C;&#x7684;&#x4E24;&#x9636;&#x6BB5;&#x9501;&#x5B9A;</h2>
<p>Strong Strict 2PL (SSPL, also known as Rigorous 2PL) is a variant of 2PL where the transaction only releases locks when it finishes. A schedule is strict if a value written by a transaction is not read or overwritten by other transactions until that transaction finishes. Thus, there is not a shrinking phase in SS2PL like in regular 2PL.
Strong Strict 2PL (SSPL&#xFF0C;&#x4E5F;&#x88AB;&#x79F0;&#x4E3A;  Rigorous 2PL) &#x662F; 2PL &#x7684;&#x53D8;&#x4F53;&#xFF0C;&#x5176;&#x4E2D;&#x4E8B;&#x52A1;&#x53EA;&#x6709;&#x5728;&#x5B8C;&#x6210;&#x7684;&#x65F6;&#x5019;&#x624D;&#x91CA;&#x653E;&#x9501;&#x3002;&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x5199;&#x5165;&#x7684;&#x503C;&#x5728;&#x8BE5;&#x4E8B;&#x52A1;&#x5B8C;&#x6210;&#x4E4B;&#x524D;&#x4E0D;&#x4F1A;&#x88AB;&#x5176;&#x4ED6;&#x4E8B;&#x52A1;&#x8BFB;&#x53D6;&#x6216;&#x8005;&#x8986;&#x76D6;&#xFF0C;&#x5219;&#x662F;&#x8C03;&#x5EA6;&#x4E25;&#x683C;&#x7684;&#x3002;&#x76F8;&#x6BD4;&#x4E8E;&#x5E38;&#x89C4; 2PL&#xFF0C;Strong Strict 2PL &#x6CA1;&#x6709;&#x6536;&#x7F29;&#x9636;&#x6BB5;&#x3002;</p>
<p>The advantage of this approach is that the DBMS does not incur cascading aborts. The DBMS can also reverse the changes of an aborted transaction by just restoring original values of modified tuples.</p>
<p>&#x8FD9;&#x79CD;&#x65B9;&#x6CD5;&#x7684;&#x6709;&#x70B9;&#x662F; DBMS &#x4E0D;&#x4F1A;&#x5BFC;&#x81F4;&#x7EA7;&#x8054;&#x4E2D;&#x6B62;&#x3002;DBMS &#x8FD8;&#x53EF;&#x4EE5;&#x901A;&#x8FC7;&#x4EC5;&#x6062;&#x590D;&#x5DF2;&#x4FEE;&#x6539;&#x7684;&#x5143;&#x7EC4;&#x7684;&#x539F;&#x59CB;&#x503C;&#x6765;&#x53CD;&#x8F6C;&#x5DF2;&#x4E2D;&#x6B62;&#x4E8B;&#x52A1;&#x7684;&#x4FEE;&#x6539;&#x3002;</p>
<h2 id="2pl-deadlock-handling--2pl-&#x6B7B;&#x9501;&#x5904;&#x7406;">2PL Deadlock Handling  2PL &#x6B7B;&#x9501;&#x5904;&#x7406;</h2>
<p>A deadlock is a cycle of transactions waiting for locks to be released by each other. There are two approaches to handling deadlocks in 2PL: detection and prevention.</p>
<p>&#x6B7B;&#x9501;&#x662F;&#x4E8B;&#x52A1;&#x4E4B;&#x95F4;&#x5FAA;&#x73AF;&#x7B49;&#x5F85;&#x5BF9;&#x65B9;&#x91CA;&#x653E;&#x9501;&#xFF0C;&#x5728; 2PL &#x4E2D;&#x6709;&#x4E24;&#x5904;&#x7406;&#x6B7B;&#x9501;&#x7684;&#x65B9;&#x6CD5;&#xFF1A;&#x68C0;&#x6D4B;&#x548C;&#x9884;&#x9632;&#x3002;</p>
<h3 id="approach-1-deadlock-detection--&#x65B9;&#x6CD5;-1-&#x6B7B;&#x9501;&#x68C0;&#x6D4B;">Approach 1: Deadlock Detection  &#x65B9;&#x6CD5; 1: &#x6B7B;&#x9501;&#x68C0;&#x6D4B;</h3>
<p>The DBMS creates a waits-for graph: Nodes are transactions, and edge from Ti to Tj if transaction Ti is waiting for transaction Tj to release a lock. The system will periodically check for cycles in waits-for graph and then make a decision on how to break it.</p>
<p>DBMS &#x521B;&#x5EFA;&#x4E00;&#x4E2A;&#x7B49;&#x5F85;&#x56FE;&#xFF1A;&#x8282;&#x70B9;&#x662F;&#x4E8B;&#x52A1;&#xFF0C;&#x5982;&#x679C;&#x4E8B;&#x52A1; Ti &#x6B63;&#x7B49;&#x5F85;&#x4E8B;&#x52A1; Tj &#x91CA;&#x653E;&#x9501;&#xFF0C;&#x53EF;&#x4EE5;&#x7528;&#x9014;&#x4E2D;&#x7684;&#x8FB9;&#x6765;&#x8868;&#x793A;&#x3002;&#x7CFB;&#x7EDF;&#x5C06;&#x5B9A;&#x671F;&#x7684;&#x68C0;&#x67E5;&#x7B49;&#x5F85;&#x56FE;&#x4E2D;&#x7684;&#x73AF;&#xFF0C;&#x7136;&#x540E;&#x51B3;&#x5B9A;&#x5982;&#x4F55;&#x53BB;&#x6253;&#x7834;&#x5B83;&#x3002;</p>
<p>&#x2022; When the DBMS detects a deadlock, it will select a &#x201C;victim&#x201D; transaction to rollback to break the cycle.</p>
<p>&#x2022; &#x5F53; DBMS &#x68C0;&#x6D4B;&#x5230;&#x6B7B;&#x9501;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x9009;&#x62E9;&#x4E00;&#x4E2A; &#x201C;&#x53D7;&#x5BB3;&#x8005;&#x201D; &#x4E8B;&#x52A1;&#x6765;&#x56DE;&#x6EDA;&#x4EE5;&#x6253;&#x7834;&#x5FAA;&#x73AF;&#x3002;</p>
<p>&#x2022; The victim transaction will either restart or abort depending on how the application invoked it</p>
<p>&#x2022; &#x53D7;&#x5BB3;&#x8005;&#x4E8B;&#x52A1;&#x5C06;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x6216;&#x4E2D;&#x6B62;&#xFF0C;&#x5177;&#x4F53;&#x600E;&#x4E48;&#x505A;&#x53D6;&#x51B3;&#x4E8E;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x8C03;&#x7528;&#x5B83;&#x7684;&#x65B9;&#x5F0F;</p>
<p>&#x2022; There are multiple transaction properties to consider when selecting a victim. There is no one choice that is better than others. 2PL DBMSs all do different things:</p>
<p>&#x9009;&#x62E9;&#x53D7;&#x5BB3;&#x8005;&#x7684;&#x65F6;&#x5019;&#x9700;&#x8981;&#x8003;&#x8651;&#x591A;&#x4E2A;&#x4E8B;&#x52A1;&#x5C5E;&#x6027;&#xFF0C;&#x6CA1;&#x6709;&#x4E00;&#x51B2;&#x9009;&#x62E9;&#x6BD4;&#x5176;&#x4ED6;&#x7684;&#x8981;&#x66F4;&#x597D;&#x3002;2PL DBMS&#x90FD;&#x505A;&#x7740;&#x4E0D;&#x540C;&#x7684;&#x4E8B;&#x60C5;&#xFF1A;</p>
<ol>
<li><p>By age (newest or oldest timestamp).</p>
</li>
<li><p>&#x4E8B;&#x52A1;&#x7684;&#x5E74;&#x9F84;&#xFF0C;&#x54EA;&#x4E2A;&#x6267;&#x884C;&#x7684;&#x4E45;</p>
</li>
<li><p>By progress (least/most queries executed).</p>
</li>
<li><p>&#x8FDB;&#x5EA6;&#xFF0C;&#x66F4;&#x591A;&#x7684;&#x67E5;&#x8BE2;&#x6267;&#x884C;</p>
</li>
<li><p>By the # of items already locked.</p>
</li>
<li><p>&#x5DF2;&#x7ECF;&#x88AB;&#x52A0;&#x9501;&#x7684; item &#x6570;&#x91CF;</p>
</li>
<li><p>By the # of transactions that we have to rollback with it.</p>
</li>
<li><p>&#x4E2D;&#x6B62;&#x8FD9;&#x4E2A;&#x4E8B;&#x52A1;&#x4E94;&#x95E8;&#x9700;&#x8981;&#x56DE;&#x6EDA;&#x7684;&#x4E8B;&#x52A1;&#x6570;&#x91CF;</p>
</li>
<li><p>of times a transaction has been restarted in the past</p>
</li>
<li><p>&#x4E8B;&#x52A1;&#x5728;&#x8FC7;&#x53BB;&#x88AB;&#x91CD;&#x542F;&#x7684;&#x6B21;&#x6570;</p>
</li>
</ol>
<p>&#x2022; Rollback Length: After selecting a victim transaction to abort, the DBMS can also decide on how far to rollback the transaction&#x2019;s changes. Can be either the entire transaction or just enough queries to break the deadlock.</p>
<p>&#x2022; &#x56DE;&#x6EDA;&#x7684;&#x957F;&#x5EA6;&#xFF1A;&#x9009;&#x62E9;&#x8981;&#x4E2D;&#x6B62;&#x7684;&#x53D7;&#x5BB3;&#x8005;&#x4E8B;&#x52A1;&#x540E;&#xFF0C;DBMS1&#x8FD8;&#x53EF;&#x4EE5;&#x51B3;&#x5B9A;&#x56DE;&#x6EDA;&#x4E8B;&#x52A1;&#x66F4;&#x6539;&#x7684;&#x7A0B;&#x5EA6;&#x3002;&#x53EF;&#x4EE5;&#x662F;&#x6574;&#x4E2A;&#x4E8B;&#x52A1;&#xFF0C;&#x4E5F;&#x53EF;&#x4EE5;&#x662F;&#x8DB3;&#x4EE5;&#x6253;&#x7834;&#x6B7B;&#x9501;&#x7684;&#x67D0;&#x4E9B;&#x67E5;&#x8BE2;&#x3002;</p>
<h3 id="approach-2-deadlock-prevention--&#x6B7B;&#x9501;&#x9884;&#x9632;">Approach 2: Deadlock Prevention  &#x6B7B;&#x9501;&#x9884;&#x9632;</h3>
<p>When a transaction tries to acquire a lock, if that lock is currently held by another transaction, then perform some action to prevent a deadlock. Assign priorities based on timestamps (e.g., older means higher priority). These schemes guarantee no deadlocks because only one type of direction is allowed when waiting for a lock. When a transaction restarts, its
(new) priority is its old timestamp.</p>
<p>&#x5F53;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x8BD5;&#x56FE;&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x9501;&#x7684;&#x65F6;&#x5019;&#xFF0C;&#x5982;&#x679C;&#x8BE5;&#x9501;&#x5F53;&#x524D;&#x88AB;&#x53E6;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x6301;&#x6709;&#xFF0C;&#x90A3;&#x4E48;&#x6267;&#x884C;&#x4E00;&#x4E9B;&#x64CD;&#x4F5C;&#x6765;&#x9632;&#x6B62;&#x6B7B;&#x9501;&#x3002;&#x6839;&#x636E;&#x65F6;&#x95F4;&#x6233;&#x6765;&#x5206;&#x914D;&#x4F18;&#x5148;&#x7EA7;&#xFF08;&#x4F8B;&#x5982;&#xFF1A;&#x8D8A;&#x65E7;&#x610F;&#x5473;&#x7740;&#x66F4;&#x9AD8;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#xFF09;&#x3002;&#x8FD9;&#x4E9B;&#x65B9;&#x6848;&#x4FDD;&#x8BC1;&#x4E86;&#x6CA1;&#x6709;&#x6B7B;&#x9501;&#xFF0C;&#x56E0;&#x4E3A;&#x5728;&#x7B49;&#x5F85;&#x9501;&#x7684;&#x65F6;&#x5019;&#x53EA;&#x5141;&#x8BB8;&#x4E00;&#x79CD;&#x7C7B;&#x578B;&#x7684;&#x65B9;&#x5411;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x91CD;&#x65B0;&#x542F;&#x52A8;&#x65F6;&#xFF0C;&#x5B83;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#x662F;&#x5B83;&#x7684;&#x65E7;&#x65F6;&#x95F4;&#x6233;&#x3002;</p>
<p>&#x2022; Wait-Die (&#x201C;Old waits for Young&#x201D;): If T1 has higher priority, T1 waits for T2. Otherwise T1 aborts</p>
<p>&#x2022; Wait-Die&#xFF08;&#x201C;Old &#x7B49;&#x5F85; Young&#x201D;&#xFF09;&#xFF1A;&#x5982;&#x679C; T1 &#x5177;&#x6709;&#x66F4;&#x9AD8;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x5219; T1 &#x7B49;&#x5F85; T2. &#x5426;&#x5219; T1 &#x4E2D;&#x6B62;</p>
<p>&#x2022; Wound-Wait (&#x201C;Young waits for Old&#x201D;): If T1 has higher priority, T2 aborts. Otherwise T1 waits.</p>
<p>&#x2022; Wound-Wait &#xFF08;&#x201C;Young &#x7B49;&#x5F85; Old&#x201D;&#xFF09;: &#x5982;&#x679C; T1 &#x5177;&#x6709;&#x66F4;&#x9AD8;&#x7684;&#x4F18;&#x5148;&#x7EA7;&#xFF0C;&#x5219; T2 &#x4E2D;&#x6B62;&#x3002;&#x5426;&#x5219; T1 &#x7B49;&#x5F85;&#x3002;</p>
<h2 id="lock-granularities---&#x9501;&#x7C92;&#x5EA6;">Lock Granularities   &#x9501;&#x7C92;&#x5EA6;</h2>
<p>If a transaction wants to update one billion tuples, it has to ask the DBMS&#x2019;s lock manager for a billion locks. This will be slow because the transaction has to take latches in the lock manager&#x2019;s internal lock table data structure as it acquires/releases locks.</p>
<p>&#x5982;&#x679C;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x60F3;&#x8981;&#x66F4;&#x65B0;&#x5341;&#x4EBF;&#x4E2A;&#x5143;&#x7EC4;&#xFF0C;&#x5B83;&#x5FC5;&#x987B;&#x5411; DBMS &#x7684;&#x9501;&#x7BA1;&#x7406;&#x5668;&#x8BF7;&#x6C42;&#x5341;&#x4EBF;&#x4E2A;&#x9501;&#x3002;&#x8FD9;&#x6837;&#x4F1A;&#x5F88;&#x6162;&#xFF0C;&#x56E0;&#x4E3A;&#x4E8B;&#x52A1;&#x5728;&#x83B7;&#x53D6;/&#x91CA;&#x653E;&#x9501;&#x7684;&#x65F6;&#x5019;&#x5FC5;&#x987B;&#x5728;&#x9501;&#x7BA1;&#x7406;&#x5668;&#x7684;&#x5185;&#x90E8;&#x9501;&#x8868;&#x6570;&#x636E;&#x7ED3;&#x6784;&#x4E2D;&#x83B7;&#x53D6;&#x9501;&#x5B58;&#x5668;</p>
<p>To avoid this overhead, the DBMS can use to use a lock hierarchy that allows a transaction to take more coarse-grained locks in the system. For example, it could acquire a single lock on the table with one billion tuples instead of one billion separate locks. When a a transaction acquires a lock for an object in this hierarchy, it implicitly acquires the locks for all its children.</p>
<p>&#x4E3A;&#x4E86;&#x907F;&#x514D;&#x8FD9;&#x79CD;&#x5F00;&#x9500;&#xFF0C;DBMS &#x53EF;&#x4EE5;&#x4F7F;&#x7528;&#x9501;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#xFF0C;&#x5141;&#x8BB8;&#x4E8B;&#x52A1;&#x5728;&#x7CFB;&#x7EDF;&#x4E2D;&#x4F7F;&#x7528;&#x66F4;&#x7C97;&#x7C92;&#x5EA6;&#x7684;&#x9501;&#x3002;&#x4F8B;&#x5982;&#xFF0C;&#x5B83;&#x53EF;&#x4EE5;&#x5728;&#x5177;&#x6709;&#x5341;&#x4EBF;&#x4E2A;&#x5143;&#x7EC4;&#x7684;&#x8868;&#x4E0A;&#x83B7;&#x53D6;&#x5355;&#x4E2A;&#x9501;&#xFF0C;&#x800C;&#x4E0D;&#x662F;&#x5341;&#x4EBF;&#x4E2A;&#x5355;&#x72EC;&#x7684;&#x9501;&#x3002;&#x5F53;&#x4E00;&#x4E2A;&#x4E8B;&#x52A1;&#x4E3A;&#x8FD9;&#x4E2A;&#x5C42;&#x6B21;&#x7ED3;&#x6784;&#x4E2D;&#x7684;&#x4E00;&#x4E2A;&#x5BF9;&#x8C61;&#x83B7;&#x53D6;&#x4E00;&#x4E2A;&#x9501;&#x65F6;&#xFF0C;&#x5B83;&#x4F1A;&#x9690;&#x5F0F;&#x7684;&#x4E3A;&#x5B83;&#x7684;&#x6240;&#x6709;&#x5B50;&#x5BF9;&#x8C61;&#x83B7;&#x53D6;&#x9501;</p>
<p>Intention locks allow a higher level node to be locked in shared or exclusive mode without having to check all descendant nodes. If a node is in an intention mode, then explicit locking is being done at a lower level in the tree.</p>
<p>&#x610F;&#x5411;&#x9501;&#x5141;&#x8BB8;&#x5C06;&#x66F4;&#x9AD8;&#x7EA7;&#x522B;&#x7684;&#x8282;&#x70B9;&#x9501;&#x5B9A;&#x4E3A;&#x5171;&#x4EAB;&#x6216;&#x8005;&#x72EC;&#x5360;&#x6A21;&#x5F0F;&#xFF0C;&#x800C;&#x65E0;&#x9700;&#x68C0;&#x67E5;&#x6240;&#x6709;&#x7684;&#x540E;&#x4EE3;&#x8282;&#x70B9;&#x3002;&#x5982;&#x679C;&#x8282;&#x70B9;&#x5904;&#x4E8E;&#x610F;&#x5411;&#x6A21;&#x5F0F;&#xFF0C;&#x5219;&#x663E;&#x793A;&#x9501;&#x5B9A;&#x5728;&#x6811;&#x4E2D;&#x7684;&#x8F83;&#x4F4E;&#x7EA7;&#x522B;&#x5B8C;&#x6210;</p>
<p>&#x2022; Intention-Shared (IS): Indicates explicit locking at a lower level with shared locks.</p>
<p>&#x2022; Intention-Shared (IS): &#x8868;&#x793A;&#x4F7F;&#x7528;&#x5171;&#x4EAB;&#x9501;&#x5728;&#x8F83;&#x4F4E;&#x7684;&#x7EA7;&#x522B;&#x663E;&#x793A;&#x9501;&#x5B9A;</p>
<p>&#x2022; Intention-Exclusive (IX): Indicates explicit locking at a lower level with exclusive or shared locks.</p>
<p>&#x2022; Intention-Exclusive (IX): &#x8868;&#x793A;&#x5177;&#x6709;&#x6392;&#x4ED6;&#x6216;&#x5171;&#x4EAB;&#x9501;&#x7684;&#x8F83;&#x4F4E;&#x7EA7;&#x522B;&#x7684;&#x663E;&#x793A;&#x9501;&#x5B9A;</p>
<p>&#x2022; Shared+Intention-Exclusive (SIX): The sub-tree rooted at that node is locked explicitly in shared mode and explicit locking is being done at a lower level with exclusive-mode locks.</p>
<p>&#x2022; Shared+Intention-Exclusive (SIX): &#x4EE5;&#x8BE5;&#x8282;&#x70B9;&#x4E3A;&#x6839;&#x7684;&#x5B50;&#x6811;&#x5728;&#x5171;&#x4EAB;&#x6A21;&#x5F0F;&#x4E0B;&#x663E;&#x793A;&#x9501;&#x5B9A;&#xFF0C;&#x5E76;&#x4E14;&#x663E;&#x793A;&#x9501;&#x5B9A;&#x5728;&#x8F83;&#x4F4E;&#x7684;&#x7EA7;&#x522B;&#x4F7F;&#x7528;&#x72EC;&#x5360;&#x6A21;&#x5F0F;&#x9501;&#x5B9A;&#x5B8C;&#x6210;</p>
<h2 id="conclusion---&#x7ED3;&#x8BBA;">Conclusion   &#x7ED3;&#x8BBA;</h2>
<p>2PL is used in most DBMSs that support transactions. The protocol automatically provides correct interleavings of transaction operations, but it requires additional steps to handle deadlocks.</p>
<p>2PL &#x7528;&#x4E8E;&#x5927;&#x591A;&#x6570;&#x652F;&#x6301;&#x4E8B;&#x52A1;&#x7684; DBMS&#x3002;&#x8BE5;&#x534F;&#x8BAE;&#x81EA;&#x52A8;&#x63D0;&#x4F9B;&#x6B63;&#x786E;&#x7684;&#x4E8B;&#x52A1;&#x64CD;&#x4F5C;&#x4EA4;&#x9519;&#xFF0C;&#x4F46;&#x662F;&#x5B83;&#x9700;&#x8981;&#x989D;&#x5916;&#x7684;&#x6B65;&#x9AA4;&#x6765;&#x5904;&#x7406;&#x6B7B;&#x9501;</p>
<p>The application does not typically set locks manually using SQL. The DBMS acquires the locks automatically before a query accesses or modifies an object. But sometimes the application can provide the DBMS with hints to help it improve concurrency:</p>
<p>&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x901A;&#x5E38;&#x4E0D;&#x4F7F;&#x7528; SQL &#x624B;&#x52A8;&#x8BBE;&#x7F6E;&#x9501;&#x3002;DBMS &#x5728;&#x67E5;&#x8BE2;&#x8BBF;&#x95EE;&#x6216;&#x4FEE;&#x6539;&#x5BF9;&#x8C61;&#x4E4B;&#x524D;&#x81EA;&#x52A8;&#x83B7;&#x53D6;&#x9501;&#x3002;&#x4F46;&#x6709;&#x65F6;&#x5E94;&#x7528;&#x7A0B;&#x5E8F;&#x53EF;&#x4EE5;&#x4E3A; DBMS &#x63D0;&#x4F9B;&#x63D0;&#x793A;&#x4EE5;&#x5E2E;&#x52A9;&#x5B83;&#x63D0;&#x9AD8;&#x5E76;&#x53D1;&#x6027;&#xFF1A;</p>
<p>SELECT...FOR UPDATE: Perform a select and then sets an exclusive lock on fetched tuples</p>
<p>SELECT...FOR UPDATE: &#x6267;&#x884C;&#x9009;&#x62E9;&#xFF0C;&#x7136;&#x540E;&#x5728;&#x83B7;&#x53D6;&#x7684;&#x5143;&#x7EC4;&#x4E0A;&#x8BBE;&#x7F6E;&#x6392;&#x4ED6;&#x9501;</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="LEC16.html" class="navigation navigation-prev " aria-label="Previous page: 第十六讲">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="LEC18.html" class="navigation navigation-next " aria-label="Next page: 第十八讲">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"第十七讲","level":"1.3.17","depth":2,"next":{"title":"第十八讲","level":"1.3.18","depth":2,"path":"cmu15455/LEC18.md","ref":"cmu15455/LEC18.md","articles":[]},"previous":{"title":"第十六讲","level":"1.3.16","depth":2,"path":"cmu15455/LEC16.md","ref":"cmu15455/LEC16.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":[],"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"cmu15455/LEC17.md","mtime":"2022-04-27T00:12:41.521Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2022-05-05T00:26:13.799Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

