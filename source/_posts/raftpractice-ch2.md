---
title: raftpractice 大论文阅读-第二章 设计 Raft 算法的动机
date: 2023-08-21 23:42:08
tags:
---

### 一、通过复制状态机来实现系统的容错

共识算法通常伴随着复制状态机出现，通过共识算法，我们实现一组拥有相同状态的计算机，我们通常把这一组拥有相同状态的计算机称为副本集。在某些机器宕机的情况下，这些计算机仍然能够继续之前的工作进行操作。

复制状态机通常通过复制日志来实现，如下图:

![](/images/rsm.png)

每个服务节点都存储着一个日志结构，它里面包含了多个对状态机操作的命令序列，它们按顺序在状态机里面执行。每个服务器里面都存储着相同顺序的命令序列，使得每个状态机执行相同序列的命令。由于状态是确定的，每个状态机都计算得到相同的状态，并且有着相同的操作输出序列。

共识算法的工作就是要保证复制日志的一致性，服务节点上的共识算法模块在服务器收到来自客户端的命令请求后，会把它追加到自己的日志中。并且和其他服务节点上的共识算法模块进行网络通信，确保每个日志都有相同顺序的相同请求。即使某些服务器故障，一旦命令请求被正确的复制了，它们就被称为已经提交的日志。每个服务节点的状态机按日志顺序处理提交的命令，并将命令输出返回给客户端。这样，服务器就像是一个单一的，高可用的机器(永不故障的单机)。

一个实际系统的共识算法通常具有以下属性：

- 它们确保在所有非拜占庭（non-Byzantine）条件下的安全性，包括网络延迟、分区、数据包丢失、重复请求和重新排序。

- 只要任何大多数服务器都可以运行并且可以相互通信以及与客户端通信，系统就是可用的。例如，典型的 5 台服务器组成的集群可用容忍人一两台服务器故障。假定服务器因停止而发生故障，它们稍后可能会从稳定的存储（持久化存储设备）上的状态恢复并重新加入集群。

- 它们不依赖时间来确保日志的一致性：在时钟错误和极端消息延迟的情况下可能会发生可用性问题。也就是说，它们是在异步的模型下保持安全性，其中消息和处理程序一任意的速度进行。

- 通常，一旦集群中的大多数成员相应了一轮远程过程调用（RPC），命令就可以完成返回客户端。少数缓慢的服务器并不影响系统整体的性能。

### 二、常用的使用复制状态机场景

复制状态机是使分布式系统具有容错的通用构建模块，它们可以以多种方式被使用，这一部分我们来讨论典型的使用案例。

对于大多数的部署模式，一般都是由 3 台或者 5 台服务器组成一个复制状态机。然后其他服务器可以使用这个状态机来协调它们的活动，如下图所示：

![](/images/rsm002.png)

我们工业上常见用来做分布式协调的应用例如 [Etcd](https://etcd.io/) 和 [Zookeeper](https://zookeeper.apache.org/) 都是这种应用模式。

这些系统通常使用复制状态机进行分布式系统的成员组，配置，还有锁的管理。

举一个更具体一点的示例：复制状态机可以提供一个容错的工作队列，而其他的服务器可以使用这个复制状态进行协调分配工作给它们自己。



### 三、Paxos 存在的问题

